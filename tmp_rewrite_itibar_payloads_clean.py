import json, hashlib
from pathlib import Path

DOC_HASH='57b1bc3b0bdb89d8266fe831c9a3e7cab2958861ae8a3590a68d96a56feb90c4'
base=Path('data/derived/supplemental_ocr')/DOC_HASH

PILLAR="\u0627\u0644\u062d\u064a\u0627\u0629 \u0627\u0644\u0641\u0643\u0631\u064a\u0629"
CORE="\u0627\u0644\u0627\u0639\u062a\u0628\u0627\u0631"

# Helper to overwrite an existing payload file with new lines/context (keeps filename stable but content changes).

def overwrite(stem: str, lines: list[str], sub: str|None):
    joined='\n'.join(lines).strip()+'\n'
    sha=hashlib.sha256(joined.encode('utf-8')).hexdigest()
    payload={
      'source_file_hash': DOC_HASH,
      'image_sha256': sha,
      'filename': f"{stem}.png",
      'lines': [ln for ln in lines if ln.strip()],
      'context': {
        'pillar_name_ar': PILLAR,
        'core_value_name_ar': CORE,
        **({'sub_value_name_ar': sub} if sub else {}),
      }
    }
    out=base/f"{sha[:16]}_{stem}.json"
    out.write_text(json.dumps(payload, ensure_ascii=False, indent=2), encoding='utf-8')
    print('rewrote', out)

# Remove old versions of the itibar payloads we created (best-effort)
for p in base.glob('*_itibar_*'):
    try: p.unlink()
    except Exception: pass

# Core Ø§Ù„Ø§Ø¹ØªØ¨Ø§Ø± concept (NO colon on ln0 to avoid becoming a sub-value)
overwrite(
  'itibar_core_concept_00',
  [
    "\u0627\u0644\u0645\u0641\u0647\u0648\u0645",
    "\u0627\u0644\u0627\u0639\u062a\u0628\u0627\u0631 \u0647\u0648 \u0639\u0645\u0644\u064a\u0629 \u0641\u0643\u0631\u064a\u0629 \u0648\u0631\u0648\u062d\u064a\u0629 \u062a\u0624\u062f\u064a \u0625\u0644\u0649 \u062a\u062d\u0644\u064a\u0644 \u0627\u0644\u062a\u062c\u0631\u0628\u0629 \u0627\u0644\u0625\u0646\u0633\u0627\u0646\u064a\u0629 (\u0645\u0646 \u062d\u0642\u0627\u0626\u0642 \u0648\u0623\u062d\u062f\u0627\u062b \u0648\u062a\u0627\u0631\u064a\u062e) \u0648\u0627\u0633\u062a\u062e\u0644\u0627\u0635 \u0627\u0644\u062f\u0631\u0648\u0633 \u0627\u0644\u0639\u0645\u0644\u064a\u0629 \u0645\u0646\u0647\u0627.",
  ],
  sub=None,
)

# Core Ø§Ù„Ø§Ø¹ØªØ¨Ø§Ø± evidence stays core-only
overwrite(
  'itibar_core_evidence_01',
  [
    "\u0627\u0644\u062a\u0623\u0635\u064a\u0644",
    "\u0642\u0627\u0644 \u062a\u0639\u0627\u0644\u0649:",
    "\u0641\u0627\u0639\u062a\u0628\u0631\u0648\u0627 \u064a\u0627 \u0623\u0648\u0644\u064a \u0627\u0644\u0623\u0628\u0635\u0627\u0631 [\u0627\u0644\u062d\u0634\u0631: 2]",
    "\u0644\u0642\u062f \u0643\u0627\u0646 \u0641\u064a \u0642\u0635\u0635\u0647\u0645 \u0639\u0628\u0631\u0629 \u0644\u0623\u0648\u0644\u064a \u0627\u0644\u0623\u0644\u0628\u0627\u0628 [\u064a\u0648\u0633\u0641: 111]",
    "\u0625\u0646 \u0641\u064a \u0630\u0644\u0643 \u0644\u0639\u0628\u0631\u0629 \u0644\u0623\u0648\u0644\u064a \u0627\u0644\u0623\u0628\u0635\u0627\u0631 [\u0622\u0644 \u0639\u0645\u0631\u0627\u0646: 13]",
    "\u0648\u0642\u0627\u0644 \u0635\u0644\u0649 \u0627\u0644\u0644\u0647 \u0639\u0644\u064a\u0647 \u0648\u0633\u0644\u0645:",
    "\u0644\u0627 \u064a\u0644\u062f\u063a \u0627\u0644\u0645\u0624\u0645\u0646 \u0645\u0646 \u062c\u062d\u0631 \u0648\u0627\u062d\u062f \u0645\u0631\u062a\u064a\u0646 (\u0645\u062a\u0641\u0642 \u0639\u0644\u064a\u0647)",
  ],
  sub=None,
)

# Sub-value Ø§Ù„ØªØ¯Ø¨Ø±: remove heading line (context provides it)
overwrite(
  'itibar_sub_tadabbur_01',
  [
    "\u0627\u0644\u0645\u0641\u0647\u0648\u0645",
    "\u0644\u0633\u0627\u0646 \u0627\u0644\u0639\u0631\u0628 (\u0645\u0627\u062f\u0629: \u062f\u0628\u0631): \u062f\u0628\u0631 \u0627\u0644\u0623\u0645\u0631 \u0648\u062a\u062f\u0628\u0631\u0647: \u0646\u0638\u0631 \u0641\u064a \u0639\u0627\u0642\u0628\u062a\u0647.",
    "\u0627\u0644\u062a\u0623\u0635\u064a\u0644",
    "\u0642\u0627\u0644 \u062a\u0639\u0627\u0644\u0649:",
    "\u0623\u0641\u0644\u0627 \u064a\u062a\u062f\u0628\u0631\u0648\u0646 \u0627\u0644\u0642\u0631\u0622\u0646 [\u0645\u062d\u0645\u062f: 24]",
    "\u0623\u0641\u0644\u0627 \u064a\u062a\u062f\u0628\u0631\u0648\u0646 \u0627\u0644\u0642\u0631\u0622\u0646 \u0648\u0644\u0648 \u0643\u0627\u0646 \u0645\u0646 \u0639\u0646\u062f \u063a\u064a\u0631 \u0627\u0644\u0644\u0647 \u0644\u0648\u062c\u062f\u0648\u0627 \u0641\u064a\u0647 \u0627\u062e\u062a\u0644\u0627\u0641\u0627 \u0643\u062b\u064a\u0631\u0627 [\u0627\u0644\u0646\u0633\u0627\u0621: 82]",
    "\u0643\u062a\u0627\u0628 \u0623\u0646\u0632\u0644\u0646\u0627\u0647 \u0625\u0644\u064a\u0643 \u0645\u0628\u0627\u0631\u0643 \u0644\u064a\u062f\u0628\u0631\u0648\u0627 \u0622\u064a\u0627\u062a\u0647 \u0648\u0644\u064a\u062a\u0630\u0643\u0631 \u0623\u0648\u0644\u0648 \u0627\u0644\u0623\u0644\u0628\u0627\u0628 [\u0635: 29]",
  ],
  sub="\u0627\u0644\u062a\u062f\u0628\u0631",
)

# Sub-value Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ ÙˆØ§Ù„Ø§Ø¨ØªÙƒØ§Ø±: use canonical name without slash; remove heading line
overwrite(
  'itibar_sub_ibdaa_02',
  [
    "\u0627\u0644\u0645\u0641\u0647\u0648\u0645",
    "\u0627\u0644\u0625\u0628\u062f\u0627\u0639: \u0625\u0646\u0634\u0627\u0621 \u0635\u0646\u0639\u0629 \u0628\u0644\u0627 \u0627\u062d\u062a\u0630\u0627\u0621 \u0648\u0627\u0642\u062a\u062f\u0627\u0621.",
    "\u0627\u0644\u062a\u0623\u0635\u064a\u0644",
    "\u0642\u0627\u0644 \u062a\u0639\u0627\u0644\u0649:",
    "\u0628\u062f\u064a\u0639 \u0627\u0644\u0633\u0645\u0627\u0648\u0627\u062a \u0648\u0627\u0644\u0623\u0631\u0636 [\u0627\u0644\u0628\u0642\u0631\u0629: 117]",
    "\u0642\u0644 \u0645\u0627 \u0643\u0646\u062a \u0628\u062f\u0639\u0627 \u0645\u0646 \u0627\u0644\u0631\u0633\u0644 [\u0627\u0644\u0623\u062d\u0642\u0627\u0641: 9]",
  ],
  sub="\u0627\u0644\u0627\u0628\u062f\u0627\u0639 \u0648\u0627\u0644\u0627\u0628\u062a\u0643\u0627\u0631",
)

# Sub-value Ø§Ù„Ø±Ø¤ÙŠØ©: remove heading line
overwrite(
  'itibar_sub_ruya_03',
  [
    "\u0627\u0644\u0645\u0641\u0647\u0648\u0645",
    "\u0627\u0644\u0631\u0624\u064a\u0629: \u0627\u0644\u0646\u0638\u0631 \u0628\u0627\u0644\u0639\u064a\u0646 \u0648\u0627\u0644\u0642\u0644\u0628... \u0648\u0627\u0644\u0631\u0623\u064a: \u0627\u0644\u0627\u0639\u062a\u0642\u0627\u062f \u0627\u0644\u0630\u064a \u064a\u0639\u062a\u0645\u062f\u0647 \u0627\u0644\u0625\u0646\u0633\u0627\u0646.",
    "\u0627\u0644\u062a\u0623\u0635\u064a\u0644",
    "\u0642\u0627\u0644 \u062a\u0639\u0627\u0644\u0649:",
    "\u0625\u0630 \u064a\u0631\u064a\u0647\u0645 \u0627\u0644\u0644\u0647 \u0641\u064a \u0645\u0646\u0627\u0645\u0643 \u0642\u0644\u064a\u0644\u0627 [\u0622\u0644 \u0639\u0645\u0631\u0627\u0646: 13]",
    "\u0642\u0644 \u0647\u0630\u0647 \u0633\u0628\u064a\u0644\u064a \u0623\u062f\u0639\u0648 \u0625\u0644\u0649 \u0627\u0644\u0644\u0647 \u0639\u0644\u0649 \u0628\u0635\u064a\u0631\u0629 \u0623\u0646\u0627 \u0648\u0645\u0646 \u0627\u062a\u0628\u0639\u0646\u064a [\u064a\u0648\u0633\u0641: 108]",
    "\u0623\u0644\u0645 \u062a\u0631 \u0643\u064a\u0641 \u0641\u0639\u0644 \u0631\u0628\u0643 \u0628\u0623\u0635\u062d\u0627\u0628 \u0627\u0644\u0641\u064a\u0644 [\u0627\u0644\u0641\u064a\u0644: 1]",
  ],
  sub="\u0627\u0644\u0631\u0624\u064a\u0629",
)

print('done')
