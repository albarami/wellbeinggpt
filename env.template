# Environment Configuration Template
# Copy this file to .env and fill in the values

# =============================================================================
# Azure OpenAI Configuration
# =============================================================================
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_KEY=your-api-key-here
AZURE_OPENAI_API_VERSION=2024-10-21

# Model Routing (based on bakeoff results 2025-12-18)
# - gpt-5.1: Best depth + lowest unexpected fail rate (1.9%) - DEFAULT
# - gpt-5-chat: Fallback (2.5% unexpected fail rate)
# - gpt-5.2: Disabled until tuned (5.6% unexpected fail rate)
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-5.1
AZURE_OPENAI_FALLBACK_DEPLOYMENT=gpt-5-chat

# =============================================================================
# Database Configuration
# =============================================================================
DATABASE_URL=postgresql://wellbeing:wellbeing_dev_password@localhost:5432/wellbeing_db

# =============================================================================
# Embedding Configuration
# =============================================================================
EMBEDDING_MODEL=text-embedding-3-large
EMBEDDING_DIMENSIONS=3072

# =============================================================================
# Application Settings
# =============================================================================
DEBUG=false
LOG_LEVEL=INFO

# =============================================================================
# Reranker Configuration (trained 2025-12-19, 8×A100 GPUs)
# =============================================================================
# Per-intent gating: reranker is applied selectively based on intent type
# - ALWAYS ON: global_synthesis, world_model_synthesis, network_build
# - CONDITIONAL: cross_pillar (when retrieval quality is low)
# - OFF: natural_chat, boundaries, simple definitions
#
# A/B test results (2025-12-20):
# - Global ON: 93.8% PASS_FULL (hurts overall)
# - Global OFF: 97.5% PASS_FULL (better overall)
# - Selective ON: Best of both (helps synthesis, doesn't hurt simple)
#
# Set to true to enable per-intent gating, false to disable completely
RERANKER_ENABLED=true
RERANKER_MODEL_PATH=checkpoints/reranker/final

# =============================================================================
# Edge Scorer Configuration (trained 2025-12-21)
# =============================================================================
# Ranks candidate edges by relevance/strength for better selection
# Used for: cross_pillar, network, global_synthesis intents
# Does NOT replace safety gates - only ranks already-grounded edges
EDGE_SCORER_ENABLED=false
EDGE_SCORER_MODEL_PATH=checkpoints/edge_scorer

# =============================================================================
# Edge Trace Logging (for collecting training data)
# =============================================================================
# Logs candidate edge pools with selected/rejected labels for training
# - PASS_FULL → training logs (data/phase2/edge_traces/train/*.jsonl)
# - PASS_PARTIAL/FAIL → debug logs (data/phase2/edge_traces/debug/*.jsonl)
# Only logs on relevant intents (cross_pillar, network, global_synthesis)
#
# Training data collection targets:
# - 2,000-5,000 PASS_FULL traces
# - 50k-200k candidate edge rows
# - Positive rate: 5-40% (computed on semantic edges only)
# - Hardness separation: 0.3-2.5
#
# IMPORTANT: Filter STRUCTURAL_SIBLING edges before training.
# These are hierarchical sibling relationships (88% of value-level edges)
# and should be excluded from semantic edge scorer training.
# Use semantic relation types only: ENABLES, REINFORCES, COMPLEMENTS,
# CONDITIONAL_ON, INHIBITS, TENSION_WITH, RESOLVES_WITH
#
# Enable in staging/production to collect real traces:
EDGE_TRACE_LOGGING=false

# Safeguards (to prevent disk growth)
EDGE_TRACE_SAMPLE_RATE=0.25         # Log 25% of eligible requests (production)
EDGE_TRACE_MAX_CANDIDATES=100       # Max candidates per request
EDGE_TRACE_MAX_FILE_MB=50           # Rotate files at 50MB

# =============================================================================
# Web UI (Next.js) -> API proxy
# =============================================================================
# Used by apps/web route handlers to proxy requests to the FastAPI backend.
API_BASE_URL=http://127.0.0.1:8000

